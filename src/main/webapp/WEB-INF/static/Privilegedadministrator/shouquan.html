<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<script src="../easyui/jquery.min.js"></script>
<script src="../easyui/jquery.easyui.min.1.js"></script>
<script src="../easyui/plugins/jquery.datagrid.js"></script>
<script src="../easyui/locale/easyui-lang-zh_CN.js"></script>
<link rel="stylesheet" href="../easyui/themes/default/easyui.css" />
<link rel="stylesheet" href="../easyui/themes/icon.css" />
<script src="../address.js"></script>
<style>
    * {
        margin: 0px;
        padding: 0px;
    }

    .sxd {
        margin-left: 363px;
        margin-top: -189px;
        position: absolute;
    }
</style>

<body>
    <!-- <div>
        网关号：
        <input type="text" name="mark" id="idd" size="20" onkeydown="if(event.keyCode==13) searchUser()" value="" />
        <button class="easyui-linkbutton" iconCls="icon-search" plain="true" id="sss" onclick="fff()">搜索</button>
        <br> 单位号：
        <input type="text" name="title" id="node_id" size="20" onkeydown="if(event.keyCode==13) searchUser()" value="" />
        <button class="easyui-linkbutton" iconCls="icon-search" plain="true" id="sss" onclick="">搜索</button>
    </div> -->
    <table id="dg" width="360" title="网关信息">
    </table>
    <div class="sxd">
        <table id="w" width="600px" toolbar="#tb" title="用户信息">
        </table>
    </div>
    <!-- <table id="chaxun" title="网关节点查询" class="easyui-datagrid" fitColumns="true" pagination="true" rownumbers="true" fit="true"
        toolbar="#tb">
        <thead>
            <tr>

            </tr>
        </thead>
    </table> -->

    <div id="tb" style="display:none">
        <div>
            <a href="javascript:openRoleAddDialog()" class="easyui-linkbutton" iconCls="icon-add" plain="true">添加</a>
            <a href="javascript:openRoleModifyDialog()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">修改</a>
            <a href="javascript:deleteRole()" class="easyui-linkbutton" iconCls="icon-remove" plain="true">删除</a>
        </div>
       
    </div>
    <div id="dlg" class="easyui-dialog" style="width: 570px;height: 350px;padding: 10px 20px" closed="true" buttons="#dlg-buttons">
        <form id="fm" method="post">
            <table cellspacing="5px;">
                <tr>
                    <td>网关号：</td>
                    <td width="80%">
                        <input type="text" id="roleName" name="getwayMark" class="easyui-validatebox" required="true" />
                    </td>
                </tr>
                <tr>
                    <td>单位名称：</td>
                    <td width="80%">
                        <input type="text" id="roleName" name="title" class="easyui-validatebox" required="true" />

                    </td>
                </tr>
                <tr>
                    <td>开始时间：</td>
                    <td width="80%">
                        <input type="text" id="roleName" name="startTime" class="easyui-validatebox" required="true" />

                    </td>
                </tr>
                <tr>
                    <td>结束时间：</td>
                    <td width="80%">
                        <input type="text" id="roleName" name="endTime" class="easyui-validatebox" required="true" />

                    </td>
                </tr>
                <tr>
                    <td>支付金额：</td>
                    <td width="80%">
                        <input type="text" id="roleName" name="pay" class="easyui-validatebox" required="true" />

                    </td>
                </tr>
            </table>
        </form>
    </div>

    <div id="dlg-buttons">
        <a href="javascript:saveRole()" class="easyui-linkbutton" iconCls="icon-ok">保存</a>
        <a href="javascript:closeRoleSaveDialog()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
    </div>

    <div id="dlg2" class="easyui-dialog" style="width: 300px;height: 450px;padding: 10px 20px" closed="true" buttons="#dlg2-buttons">
        <ul id="tree" class="easyui-tree"></ul>
    </div>

</body>
<script>

 var id;
    $(function () {
        $("#dg").datagrid({
            dataType: 'json',
            url: address+"/data/getways/simple",
            columns: [

                [{
                        title: '编号',
                        field: 'Id',
                        width: 100,
                        checkbox: true, //这个checkbox:true 就表示让Id这一行显示为复选框的样式。  
                    },
                    {
                        field: 'getwayMark',
                        title: '网关号',
                        width: 110
                    },
                    {
                        field: 'statusDesc',
                        title: '网关状态',
                        width: 110
                    },
                    {
                        field: 'endTime',
                        title: '租约到期时间',
                        width: 110
                    }
                ]
            ],
            pagination: true,
            pageSize: 10,
            pageList: [1, 2, 10],
            onClickRow: function (index, row) {

                var id = row["getwayMark"];

                //     $.ajax({
                //         url: "http://192.168.3.2:8888/data/getway/" + id + "/subNodes",
                //         type: 'post',

                //         success: function () {

                //             $('#w').window('open');
                //         }

                //     });

                $("#w").datagrid({
                    dataType: 'json',
                    url: address+"/author/rents/" + id + "/unit",
                    columns: [
                        [{
                                title: '编号',
                                field: 'rentId',
                                width: 100,
                                checkbox: true, //这个checkbox:true 就表示让Id这一行显示为复选框的样式。  
                                singleSelect: true

                            },
                            {
                                field: 'title',
                                title: '单位名称',
                                width: 110
                            },
                            {
                                field: 'startTime',
                                title: '开始时间',
                                width: 120
                            },
                            {
                                field: 'endTime',
                                title: '结束时间',
                                width: 120
                            }
                            ,
                            {
                                field: 'pay',
                                title: '支付金额',
                                width: 110
                            }
                            ,
                            {
                                field: 'status',
                                title: '状态',
                                width: 110
                            }
                         
                        ]
                    ],
                    pagination: true,
                    pageSize: 8,
                    pageList: [8],
                });

            }


        });
    })

    function openRoleAddDialog() {
        $("#dlg").dialog("open").dialog("setTitle", "添加租用信息");
        url = address+"/author/getway"; 
    }
 
    function saveRole() {
        $("#fm").form("submit", {
            url: url,
            type:'POST',
                xhrFields: {
				withCredentials: true
			},
			crossDomain:true,
            onSubmit: function () {
                return $(this).form("validate");
            },
            success: function (result) {
                alert(url);
                console.log(result);
                if (result.success == true) {
                    $.messager.alert('系统提示', "<font color=red>" + result.message + "</font>");

                } else {
                    $.messager.alert('系统提示', '保存成功');
                    closeRoleSaveDialog();
                    $("#dg").datagrid("reload");
                }
            },

        });
    }
    function openRoleModifyDialog() {
        var selectedRows = $("#w").datagrid('getSelections');

        if (selectedRows.length != 1) {
            $.messager.alert('系统提示', '请选择一条要编辑的数据！');
            return;
        }

        var row = selectedRows[0];
        $("#dlg").dialog("open").dialog("setTitle", "修改信息");
        $("#fm").form("load", row);
        url = address+"/manage/getway/update"; //修改的时候的url
    }


    function deleteRole() {
        var selectedRows = $("#w").datagrid('getSelections');

        if (selectedRows.length == 0) {
            $.messager.alert('系统提示', '请选择要删除的数据！');
            return;
        }
        var strIds = [];
        for (var i = 0; i < selectedRows.length; i++) {
            strIds.push(selectedRows[i].rentId);
        }

        var ids = strIds.join("_");
        alert(ids);
        $.messager.confirm("系统提示", "您确认要删除这<font color=red>" + selectedRows.length + "</font>条数据吗？", function (r) {
            if (r) {
                $.ajax({
                    url: address+"/batch/rent/" + ids,
                    type: 'delete',
                    xhrFields: {
                        withCredentials: true
                    },
                    crossDomain: true,
                    success: function (result) {
                        if (result.success) {
                            $.messager.alert('系统提示', "您已成功删除数据！");
                            $("#dg").datagrid("reload");
                        } else {
                            alert("删除失败");
                        }
                    }
                });
            }
        });
    }

</script>

<script>
  
   
//   function saveRole() {
       

//         $.ajax({
//             url: url,
//             type = 'post',
//             xhrFields: {
//                 withCredentials: true
//             },
//             crossDomain: true,
//             data: $('#fm').serialize(),
//             success: function (result) {

//                 if (result.success == true) {
//                     alert("保存成功");

//                 } else {
//                     alert("保存失败");
//                 }
//             }
//         });
//     }



    function searchRole() {
        // $.ajax({
        //     type: 'post',
        //     url: "http://192.168.3.2:8888/data/getway/" + $("#idd").value,
        //     success: function (data) {
        //         // alert($("#idd").val());

        $("#w").datagrid({
            dataType: 'json',
            url: "http://10.28.44.241:8888/data/getway/" + $("#idd").val(),
            columns: [
                [{
                        title: '编号',
                        field: 'Id',
                        width: 100,
                        checkbox: true, //这个checkbox:true 就表示让Id这一行显示为复选框的样式。  
                    },
                    {
                        field: 'getwayMark',
                        title: '网关号',
                        width: 248
                    },
                    {
                        field: 'status',
                        title: '网关状态',
                        width: 248
                    }
                ]
            ],

        });
    }
    //     });
    // }
    function closeRoleSaveDialog() {
        $("#dlg").dialog("close");
        $("#fm").form('clear');
    }
    </script>
<script>

   
</script>





</html>