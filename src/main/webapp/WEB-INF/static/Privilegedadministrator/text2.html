<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>温湿度查询</title>
    <!--导入相关插件-->
    <script src="../easyui/jquery.min.js"></script>
    <script src="../easyui/jquery.easyui.min.1.js"></script>
    <script src="../easyui/plugins/jquery.datagrid.js"></script>
    <script src="../easyui/locale/easyui-lang-zh_CN.js"></script>
    <link rel="stylesheet" href="../easyui/themes/default/easyui.css" />
    <link rel="stylesheet" href="../easyui/themes/icon.css" />
    <script src="../jquery-ui-1.12.1.custom/jquery-ui-1.12.1.custom/jquery-ui.min.css"></script>
    <script src="http://cdn.static.runoob.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
        var j = jQuery.noConflict();
    </script>
    <script src="../jquery-ui-1.12.1.custom/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="http://jqueryui.com/resources/demos/style.css">
    <script src="../address.js"></script>


</head>
<style type="text/css">

</style>

<body>
    <form method="post" id="form">

        &nbsp;节点号：&nbsp;
        <input type="text" name="nodeMark" id="autocomplete" size="20" onkeydown="if(event.keyCode==13) searchRole()" /> &nbsp;上报时间：&nbsp;
        <input class="easyui-datetimebox" name="startTime" id="startTime" data-options="required:true,showSeconds:false" value="3/4/2010 2:3"
            style="width:150px" onkeydown="if(event.keyCode==13) searchRole()">__
        <input class="easyui-datetimebox" name="endTime" id="endTime" data-options="required:true,showSeconds:false" value="3/4/2010 2:3"
            style="width:150px" onkeydown="if(event.keyCode==13) searchRole()">

    </form>
    <a href="javascript:searchRole()" class="easyui-linkbutton" iconCls="icon-search" plain="true">搜索</a>
    <a href="javascript:download()" class="easyui-linkbutton" iconCls="icon-search" plain="true">下载</a>

    <table id="dg" title="温湿度查询" class="easyui-datagrid">
        <thead>
            <tr>
            </tr>
        </thead>
    </table>

</body>

<script type="text/javascript">
    $(document).ready(function () {
        $.ajax({
            url: address + '/data/node/tree',
            type: "get",
            dataType: 'json',
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true,
            success: function (data) {
                var kaiguan = [];

                for (var value in data) {
                    var i = data[value].subIds;
                    kaiguan.push(i);
                }
                var a = eval(kaiguan); //所有的节点以及网关号
                console.log(kaiguan[1]);
                var c = kaiguan[1].concat(kaiguan[0]);
                var d = c.concat(kaiguan[2]);

                $(document).ready(function () {
                    j("#nodeMark1").autocomplete({
                        source:function (request, response) {
                            var matcher = new RegExp("^" + $.ui.autocomplete.escapeRegex(
                                request.term), "i");
                            response($.grep(d, function (item) {
                                return matcher.test(item);
                            }));
                        }

                    });
                });
            }
        });
    });

    function download() {
        var url = address + "/query/excel"
        $("#form").attr("action", url);
        $("#form").submit();
    }

    function searchRole() {
        $("#dg").datagrid({
            dataType: 'json',
            type: 'post',
            queryParams: {
                nodeMark: $("#autocomplete").val(),
                startTime: $("#startTime").val(),
                endTime: $("#endTime").val(),
            },
            url: address + "/query/th/reportTime",
            columns: [
                [{
                        field: 'nodeMark',
                        title: 'nodeMark',
                        width: 425
                    },
                    {
                        field: 'temper',
                        title: 'temper',
                        width: 425
                    },
                    {
                        field: 'humidity',
                        title: 'humidity',
                        width: 425
                    },
                    {
                        field: 'reportTime',
                        title: 'reportTime',
                        width: 425
                    }
                ]
            ],
            pagination: true,
            pageSize: 10,
            pageList: [5, 10, 20]
        });
    }
</script>

</html>