<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<script src="../easyui/jquery.min.js"></script>
<script src="../easyui/jquery.easyui.min.js"></script>
<script src="../easyui/plugins/jquery.datagrid.js"></script>
<script src="../easyui/locale/easyui-lang-zh_CN.js"></script>
<link rel="stylesheet" href="../easyui/themes/default/easyui.css" />
<link rel="stylesheet" href="../easyui/themes/icon.css" />
<script src="../address.js"></script>
<style>
    * {
        margin: 0px;
        padding: 0px;
    }

    .sxd {
        margin-left: 510px;
        margin-top: -251px;
        position: absolute;
    }
</style>

<body>
    <!-- <div>
        网关号：
        <input type="text" name="mark" id="idd" size="20" onkeydown="if(event.keyCode==13) searchUser()" value="" />
        <button class="easyui-linkbutton" iconCls="icon-search" plain="true" id="sss" onclick="fff()">搜索</button>
        <br> 单位号：
        <input type="text" name="title" id="node_id" size="20" onkeydown="if(event.keyCode==13) searchUser()" value="" />
        <button class="easyui-linkbutton" iconCls="icon-search" plain="true" id="sss" onclick="">搜索</button>
    </div> -->
    <table id="dg" width="510">

    </table>
    <div class="sxd">
        <table id="w" width="830px" toolbar="#tb" title="节点输出控制">
        </table>
    </div>

    <!-- <table id="chaxun" title="网关节点查询" class="easyui-datagrid" fitColumns="true" pagination="true" rownumbers="true" fit="true"
        toolbar="#tb">
        <thead>
            <tr>

            </tr>
        </thead>
    </table> -->

    <div id="tb">
        <div>
            <a href="javascript:openRoleAddDialog()" class="easyui-linkbutton" iconCls="icon-add" plain="true">添加</a>
            <a href="javascript:openRoleModifyDialog()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">修改</a>
            <a href="javascript:deleteRole()" class="easyui-linkbutton" iconCls="icon-remove" plain="true">删除</a>
        </div>
        <div>
            &nbsp;节点号：&nbsp;
            <input type="text" name="mark" id="idd" size="20" onkeydown="if(event.keyCode==13) searchRole()" />
            <a href="javascript:searchRole()" class="easyui-linkbutton" iconCls="icon-search" plain="true">搜索</a>
        </div>
    </div>
    <div id="dlg" class="easyui-dialog" style="width: 570px;height: 350px;padding: 10px 20px" closed="true" buttons="#dlg-buttons">
        <form id="fm" method="post">
            <table cellspacing="5px;">
                <tr>
                    <td>节点盒子对应ID：</td>
                    <td width="80%">
                        <input type="text" id="roleName" name="getwayMark" class="easyui-validatebox" required="true" />
                    </td>
                </tr>
                <tr>
                    <td>网关状态：</td>
                    <td width="80%">
                        <input type="text" id="roleName" name="status" class="easyui-validatebox" required="true" list="itemlist" />
                        <datalist id="itemlist">
                            <option value="0">在线</option>
                            <option value="1">不在线</option>
                        </datalist>
                    </td>
                </tr>
                <tr>
                    <td>是否为备用节点：</td>
                    <td width="80%">
                        <input type="text" id="roleName" name="spareNode" class="easyui-validatebox" required="true" list="itemlist2" />
                        <datalist id="itemlist2">
                            <option value="0">否</option>
                            <option value="1">是</option>
                        </datalist>
                    </td>
                </tr>
                <tr>
                    <td>节点号：</td>
                    <td width="80%">
                        <input type="text" id="roleName" name="nodeNum" class="easyui-validatebox" required="true" />
                    </td>
                </tr>
                <tr>
                    <td>上报时间间隔：</td>
                    <td width="80%">
                        <input type="text" id="roleName" name="timeInter" class="easyui-validatebox" required="true" />
                    </td>
                </tr>
                <tr>
                    <td>备注：</td>
                    <td width="80%">
                        <input type="text" id="roleName" name="memo" class="easyui-validatebox" required="true" />
                    </td>
                </tr>
            </table>
        </form>
    </div>

    <div id="dlg-buttons">
        <a href="javascript:saveRole()" class="easyui-linkbutton" iconCls="icon-ok">保存</a>
        <a href="javascript:closeRoleSaveDialog()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
    </div>

    <div id="dlg2" class="easyui-dialog" style="width: 300px;height: 450px;padding: 10px 20px" closed="true" buttons="#dlg2-buttons">
        <ul id="tree" class="easyui-tree"></ul>
    </div>

    <!-- <table id="chaxun" width="500">
        <div id="toolbar">
            <div id="toolbar3">
                <a href="#">添加</a>
                <a href="#">删除</a>
                <a href="#">修改</a>
            </div>
        </div>
    </table> -->
</body>
<!-- 
<div id="wangguan">
        <table class="easyui-datagrid" style="width:200px;height:250px"   
        data-options="url:'wangguan.json',fitColumns:true,singleSelect:true">   
    <thead>   
        <tr>   
            <th data-options="field:'nodeId',width:100">网关号</th>   
        </tr>   
    </thead>   
</table> 
</div> -->
<script>
    var id;
    $(function () {
        $("#dg").datagrid({
            dataType: 'json',
            url: address+"/data/getways/simple",
            columns: [

                [{
                        title: '编号',
                        field: 'Id',
                        width: 100,
                        checkbox: true, //这个checkbox:true 就表示让Id这一行显示为复选框的样式。  
                    },
                    {
                        field: 'getwayMark',
                        title: '网关号',
                        width: 250
                    },
                    {
                        field: 'status',
                        title: '网关状态',
                        width: 250
                    }
                ]
            ],
            pagination: true,
            pageSize: 10,
            pageList: [1, 2, 10],
            onClickRow: function (index, row) {

                id = row["getwayMark"];

                $.ajax({
                    url: address+"/data/getway/" + id + "/subNodes",
                    type: 'post',

                    success: function () {

                        $('#w').window('open');
                    }

                });
                $("#w").datagrid({
                    dataType: 'json',
                    url: address+"/data/getway/" + id + "/subNodes",
                    columns: [
                        [{
                                title: '编号',
                                field: 'Id',
                                width: 100,
                                checkbox: true, //这个checkbox:true 就表示让Id这一行显示为复选框的样式。  
                                singleSelect: true

                            },
                            {
                                field: 'nodeId',
                                title: '节点号',
                                width: 200
                            },
                            {
                                field: 'status',
                                title: '网关状态',
                                width: 200
                            },
                            {
                                field: 'status',
                                title: '开关',
                                width: 200
                            },
                            {
                                field: 'status',
                                title: '网关控制信号的输出',
                                width: 200
                            }
                        ]
                    ],
                    pagination: true,
                    pageSize: 8,
                    pageList: [8],


                });

            }


        });
    })

    function searchRole() {
        // $.ajax({
        //     type: 'post',
        //     url: "http://192.168.3.2:8888/data/getway/" + $("#idd").value,
        //     success: function (data) {
        //         // alert($("#idd").val());

        $("#w").datagrid({
            dataType: 'json',
            url: address+"/data/getway/" + $("#idd").val(),
            columns: [
                [{
                        title: '编号',
                        field: 'Id',
                        width: 100,
                        checkbox: true, //这个checkbox:true 就表示让Id这一行显示为复选框的样式。  
                    },
                    {
                        field: 'getwayMark',
                        title: '网关号',
                        width: 248
                    },
                    {
                        field: 'status',
                        title: '网关状态',
                        width: 248
                    }
                ]
            ],

        });
    }
    //     });
    // }




    var url = "";

    function openRoleAddDialog() {
        $("#dlg").dialog("open").dialog("setTitle", "添加节点信息");
        url = address+"/manage/getway"; //添加节点信息的时候的url
    }

    function saveRole() {
        $("#fm").form("submit", {
            url: url,

            onSubmit: function () {
                return $(this).form("validate");
            },
            success: function (result) {
                alert(url);
                console.log(result);
                if (result.success == true) {
                    $.messager.alert('系统提示', "<font color=red>" + result.message + "</font>");

                } else {
                    $.messager.alert('系统提示', '保存成功');
                    closeRoleSaveDialog();
                    $("#dg").datagrid("reload");
                }
            },

        });
    }



    function closeRoleSaveDialog() {
        $("#dlg").dialog("close");
        $("#fm").form('clear');
    }


    function deleteRole() {
        var selectedRows = $("#w").datagrid('getSelections');

        if (selectedRows.length == 0) {
            $.messager.alert('系统提示', '请选择要删除的数据！');
            return;
        }
        var strIds = [];
        for (var i = 0; i < selectedRows.length; i++) {
            strIds.push(selectedRows[i].nodeId);
        }
        alert(strIds);
        var ids = strIds.join(",");
        $.messager.confirm("系统提示", "您确认要删除这<font color=red>" + selectedRows.length + "</font>条数据吗？", function (r) {
            if (r) {
                $.ajax({
                    url: address+"/manage/getways/" + strIds,
                    type: 'delete',
                    success: function (result) {
                        if (result.success) {
                            $.messager.alert('系统提示', "您已成功删除数据！");
                            $("#dg").datagrid("reload");
                        } else {
                            $.messager.alert('系统提示', '<font color=red>' + selectedRows[result.errorIndex]
                                .roleName + '</font>' + result.errorMsg);
                        }
                    }
                });
            }
        });
    }

    function openRoleModifyDialog() {
        var selectedRows = $("#w").datagrid('getSelections');

        if (selectedRows.length != 1) {
            $.messager.alert('系统提示', '请选择一条要编辑的数据！');
            return;
        }

        var row = selectedRows[0];
        $("#dlg").dialog("open").dialog("setTitle", "修改信息");
        $("#fm").form("load", row);
        url = address+"/manage/getway/update"; //修改的时候的url
    }
</script>





</html>