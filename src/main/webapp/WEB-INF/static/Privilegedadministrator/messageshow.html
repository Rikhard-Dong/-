<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<script src="../easyui/jquery.min.js"></script>
<script src="../easyui/jquery.easyui.min.js"></script>
<script src="../easyui/plugins/jquery.datagrid.js"></script>
<script src="../easyui/locale/easyui-lang-zh_CN.js"></script>
<link rel="stylesheet" href="../easyui/themes/default/easyui.css" />
<link rel="stylesheet" href="../easyui/themes/icon.css" />
<style>
    * {
        margin: 0px;
        padding: 0px;
    }

    .sxd {
        margin-left: 510px;
        margin-top: -205px;
        position: absolute;
    }

    input {
        border: 0px solid rgb(187, 17, 17);

        border-radius: 3px;
    }
</style>

<body>
    <!-- <div>
        网关号：
        <input type="text" name="mark" id="idd" size="20" onkeydown="if(event.keyCode==13) searchUser()" value="" />
        <button class="easyui-linkbutton" iconCls="icon-search" plain="true" id="sss" onclick="fff()">搜索</button>
        <br> 单位号：
        <input type="text" name="title" id="node_id" size="20" onkeydown="if(event.keyCode==13) searchUser()" value="" />
        <button class="easyui-linkbutton" iconCls="icon-search" plain="true" id="sss" onclick="">搜索</button>
    </div> -->
    <table id="dg" width="510" title="网关的信息显示">
    </table>
    <div class="sxd">
        <table id="w" width="760px" toolbar="#tb" title="节点网关的信息显示">
        </table>
    </div>
    <!-- <table id="chaxun" title="网关节点查询" class="easyui-datagrid" fitColumns="true" pagination="true" rownumbers="true" fit="true"
        toolbar="#tb">
        <thead>
            <tr>

            </tr>
        </thead>
    </table> -->
    <div id="dlg" class="easyui-dialog" style="width: 570px;height: 350px;padding: 10px 20px" closed="true" buttons="#dlg-buttons">
        <form id="fm" method="post">
            <table cellspacing="5px;">
                <input id="snr" name="snr" type="text" value="" />
                </label>
                <br>
                <br>
                <input id="nodenum" name="nodenum" type="text" value="" />
                </label>
                <br>
                <br>
                <tr>
                    <label>
                        <input id="hand1" name="autoflag" type="radio" value="0" />手动(请先选择该项) </label>
                    <label>
                        <input id="auto1" name="autoflag" type="radio" value="F" />自动 </label>
                </tr>
                <br>
                <br>
                <b>自动参数设置</b>
                <br>
                <br>
                <div id="zidongshezhi" style="display:none">

                    标志位：
                    <select name="flag">
                        <option value="F">温度</option>

                        <option value="0">湿度</option>
                    </select>
                    <br>
                    <br> 启停位1：
                    <select name="ss1">
                        <option value="F">开启</option>
                        <option value="0">关闭</option>
                    </select>
                    数值1：大于等于
                    <input type="text" name="ssvalue1" />
                    <br>
                    <br> 启停位2：
                    <select name="ss2">
                        <option value="F">开启</option>
                        <option value="0">关闭</option>
                    </select>
                    数值1：小于等于
                    <input type="text" name="ssvalue2" />
                </div>

                <div id="shoudong" style="display:none;">
                    标志位：
                    <select name="flag2">
                        <option value="F">开启</option>
                        <option value="0">关闭</option>
                    </select>
                </div>
            </table>
        </form>
    </div>
    <div id="dlg-buttons">
        <a href="javascript:saveRole()" class="easyui-linkbutton" iconCls="icon-ok">保存</a>
        <a href="javascript:closeRoleSaveDialog()" class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
    </div>
    <div id="dlg2" class="easyui-dialog" style="width: 300px;height: 450px;padding: 10px 20px" closed="true" buttons="#dlg2-buttons">
        <ul id="tree" class="easyui-tree"></ul>
    </div>
    <div id="messageShow" style="margin-left:1360px; margin-top:-190px; display:none;border:1px solid black ">
        <ul>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp; &nbsp&nbsp&nbsp
            <input id="head" value="" readonly="true" />
        </ul>
        <ul id="png1">
            &nbsp&nbsp&nbsp&nbsp
            <img src="../images/sun.png">
            <input id="sun" value="1" readonly="true" />
        </ul>
        <br>
        <ul id="png2">
            &nbsp&nbsp&nbsp&nbsp
            <img src="../images/kaiguan.png">
            <input id="kaiguan" value="1" readonly="true" /> </ul>
        <br>
        <ul id="png3">
            &nbsp&nbsp&nbsp&nbsp
            <img src="../images/windy.png">
            <input id="windy" value="1" readonly="true" /> </ul>
        <br>
        <ul id="png4">
            &nbsp&nbsp&nbsp&nbsp
            <img src="../images/power.png">
            <input id="power" value="1" readonly="true" />
        </ul>
        <br> 当前状态
        <input id="auto_or" type="text" readonly="true" />
        <br>
        <br>
        <button style="margin-left:60px;" id="btn_1">点击切换手自动开关</button>
    </div>

</body>
<script>


    $(function () {
        $("#btn_1").click(function () {
            $("#dlg").dialog("open").dialog("setTitle", "添加控制信息");

        });
    });

    $(function () {
        $("#hand1").click(function () {
            $("#shoudong").show();
            $("#zidongshezhi").hide();
            document.getElementById("auto_or").value = "手动";
        });
    });

    $(function () {
        $("#auto1").click(function () {
            $("#zidongshezhi").show();
            $("#shoudong").hide();
            document.getElementById("auto_or").value = "自动";
        });
    });


    var id;
    var nodeIdd;
    var statuss;
    var dianliang;
    var shidu;
    $(function () {
        $("#dg").datagrid({
            dataType: 'json',
            url: "http://192.168.3.2:8888/data/getways/simple",
            columns: [

                [{
                        title: '编号',
                        field: 'getwayId',
                        width: 100,
                        checkbox: true, //这个checkbox:true 就表示让Id这一行显示为复选框的样式。  
                    },
                    {
                        field: 'getwayMark',
                        title: '网关号',
                        width: 250
                    },
                    {
                        field: 'status',
                        title: '网关状态',
                        width: 250
                    },
                    {
                        field: 'snr',
                        title: 'snr',
                        width: 250
                    }
                ]
            ],
            pagination: true,
            pageSize: 10,
            pageList: [1, 2, 10],
            onClickRow: function (index, row) {

                id = row["getwayId"];
                snrs = row["snr"];
                // $.ajax({
                //     url: "http://192.168.3.2:8888/remote/nodeInfo/"+id,
                //     type: 'post',

                //     success: function () {

                //         $('#w').window('open');
                //     }

                // });
                $("#w").datagrid({
                    dataType: 'json',
                    url: "http://192.168.3.2:8888/remote/nodeInfo/" + id,
                    type: "get",
                    columns: [
                        [{
                                title: '编号',
                                field: 'Id',
                                width: 150,
                                checkbox: true, //这个checkbox:true 就表示让Id这一行显示为复选框的样式。  
                                singleSelect: true

                            },
                            {
                                field: 'nodenum',
                                title: '节点号',
                                width: 150
                            },
                            {
                                field: 'temper',
                                title: '节点的温度℃',
                                width: 100
                            },
                            {
                                field: 'humid',
                                title: '节点的湿度RH',
                                width: 100
                            },
                            {
                                field: 'power',
                                title: '节点的电量%',
                                width: 100

                            },
                            {
                                field: 'type',
                                title: '状态开关',
                                width: 100
                            },
                            {
                                field: 'reporttime',
                                title: '上报时间',
                                width: 150
                            },
                            {
                                field: 'snr',
                                title: 'snr',
                                width: 150
                            }
                        ]
                    ],
                    pagination: true,
                    pageSize: 8,
                    pageList: [8],
                    onClickRow: function (index, row) {
                        nodeIdd = row["nodenum"];
                        temper2 = row["temper"];
                        statuss = row["type"];
                        dianliang = row["power"];
                        shidu = row["humid"];
                        snr = row["snr"];

                        f(nodeIdd, temper2, statuss, dianliang, shidu, snr, snrs);
                        $("#messageShow").fadeIn("slow");
                        $.ajax({
                            url: 'http://192.168.3.2:8888/remote/node/status/' +
                                snrs,
                            type: 'get',
                            success: function (result) {
                                var a = eval('(' + result + ')');
                                var  kaiguan=[];
                             for(var value  in a)
                             {
                                var  i=a[value].auto;
                                kaiguan.push(i);
                             }

                             var  b=eval(kaiguan);
                             var c=parseInt(b);
                           if(c==0)
                           {
                            document.getElementById("auto_or").value = "手动";
                           }
                               else{
                                document.getElementById("auto_or").value = "自动";
                               }
                            },



                        });

                    },

                });

            }
        });
    });

    function f(nodeIdd, temper2, statuss, dianliang, shidu, snr, snrs) {

        document.getElementById("sun").value = temper2;
        document.getElementById("windy").value = shidu;
        document.getElementById("power").value = dianliang;
        document.getElementById("kaiguan").value = statuss;
        document.getElementById("head").value = snr;
        document.getElementById("snr").value = snrs;
        document.getElementById("nodenum").value = snr;
    }


    function searchRole() {
        // $.ajax({
        //     type: 'post',
        //     url: "http://192.168.3.2:8888/data/getway/" + $("#idd").value,
        //     success: function (data) {
        //         // alert($("#idd").val());

        $("#w").datagrid({
            dataType: 'json',
            url: "http://192.168.3.2:8888/data/getway/" + $("#idd").val(),
            columns: [
                [{
                        title: '编号',
                        field: 'Id',
                        width: 100,
                        checkbox: true, //这个checkbox:true 就表示让Id这一行显示为复选框的样式。  
                    },
                    {
                        field: 'getwayMark',
                        title: '网关号',
                        width: 248
                    },
                    {
                        field: 'status',
                        title: '网关状态',
                        width: 248
                    }
                ]
            ],

        });
    }
    //     });
    // }




    var url = "";

    function openRoleAddDialog() {
        $("#dlg").dialog("open").dialog("setTitle", "添加节点信息");
        url = "http://192.168.3.2:8888/manage/getway"; //添加节点信息的时候的url
    }

    function saveRole() {
        //   $.ajax({
        //     url:'http://192.168.3.2:8888/remote/node/status/'+$("#head").val(),
        //     type:'get',
        //     data:{},

        //   });

        $("#fm").form("submit", {
            url: 'http://192.168.3.2:8888/remote/nodeSet',
            type: 'get',
            onSubmit: function () {
                return $(this).form("validate");
            },
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true,
            success: function (result) {


                console.log(result);

            },

        });
    }

    function closeRoleSaveDialog() {
        $("#dlg").dialog("close");
        $("#fm").form('clear');
    }

    function deleteRole() {
        var selectedRows = $("#w").datagrid('getSelections');

        if (selectedRows.length == 0) {
            $.messager.alert('系统提示', '请选择要删除的数据！');
            return;
        }
        var strIds = [];
        for (var i = 0; i < selectedRows.length; i++) {
            strIds.push(selectedRows[i].nodeId);
        }
        alert(strIds);
        var ids = strIds.join(",");
        $.messager.confirm("系统提示", "您确认要删除这<font color=red>" + selectedRows.length + "</font>条数据吗？", function (r) {
            if (r) {
                $.ajax({
                    url: "http://192.168.3.2:8888/manage/getways/" + strIds,
                    type: 'delete',
                    success: function (result) {
                        if (result.success) {
                            $.messager.alert('系统提示', "您已成功删除数据！");
                            $("#dg").datagrid("reload");
                        } else {
                            $.messager.alert('系统提示', '<font color=red>' + selectedRows[result.errorIndex]
                                .roleName + '</font>' + result.errorMsg);
                        }
                    }
                });
            }
        });
    }

    function openRoleModifyDialog() {
        var selectedRows = $("#w").datagrid('getSelections');

        if (selectedRows.length != 1) {
            $.messager.alert('系统提示', '请选择一条要编辑的数据！');
            return;
        }

        var row = selectedRows[0];
        $("#dlg").dialog("open").dialog("setTitle", "修改信息");
        $("#fm").form("load", row);
        url = "http://192.168.3.2:8888/manage/getway/update"; //修改的时候的url
    }
</script>

</html>