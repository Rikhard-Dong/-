<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>温湿度查询</title>
    <!--导入相关插件-->
    <script src="../easyui/jquery.min.js"></script>
    <script src="../easyui/jquery.easyui.min.1.js"></script>
    <script src="../easyui/plugins/jquery.datagrid.js"></script>
    <script src="../easyui/locale/easyui-lang-zh_CN.js"></script>
    <link rel="stylesheet" href="../easyui/themes/default/easyui.css" />
    <link rel="stylesheet" href="../easyui/themes/icon.css" />
    <script src="../jquery-ui-1.12.1.custom/jquery-ui-1.12.1.custom/jquery-ui.min.css"></script>
    <script src="http://cdn.static.runoob.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
        var j = jQuery.noConflict();
    </script>
    <script src="../jquery-ui-1.12.1.custom/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="http://jqueryui.com/resources/demos/style.css">
    <script src="../address.js"></script>


</head>
<style type="text/css">

</style>

<body>
    <form method="post" id="form">
        &nbsp;节点号：&nbsp;
        <select type="text" name="nodeMark" id="autocomplete" style="width:140px" onkeydown="if(event.keyCode==13) searchRole()"></select>
        &nbsp;上报时间：&nbsp;
        <input class="easyui-datetimebox" name="startTime" id="startTime" data-options="required:true,showSeconds:false" value="3/4/2010 2:3"
            style="width:150px" onkeydown="if(event.keyCode==13) searchRole()">__
        <input class="easyui-datetimebox" name="endTime" id="endTime" data-options="required:true,showSeconds:false" value="3/4/2010 2:3"
            style="width:150px" onkeydown="if(event.keyCode==13) searchRole()">
        <a href="javascript:searchRole()" class="easyui-linkbutton" iconCls="icon-search" plain="true">搜索</a>
        <a href="javascript:download()" class="easyui-linkbutton" iconCls="icon-search" plain="true">下载</a>
    </form>


    <table id="dg" title="温湿度查询" class="easyui-datagrid">
        <thead>
            <tr>
            </tr>
        </thead>
    </table>

</body>
<script type="text/javascript">
    $(document).ready(function () {
        $.ajax({
            url: address + '/data/node/tree',
            type: "get",
            dataType: 'json',
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true,
            success: function (data) {
                var kaiguan = [];
                var kaiguan1 = [];
                var kaiguan2 = [];
                var kaiguan3 = [];
                var kaiguan4 = [];
                for (var value in data) {
                    var i = data[value].subIds;
                    var j = data[value].parentId;
                    kaiguan.push(i);
                    kaiguan4.push(j);
                }
                var p = eval(kaiguan4);

                var a = eval(kaiguan);
                for (var value in a[0]) {
                    var i = a[0][value];
                    kaiguan1.push(i);
                }
                var b = eval(kaiguan1);
                for (var value in a[1]) {
                    var i = a[1][value];
                    kaiguan2.push(i);
                }
                var c = eval(kaiguan2);
                for (var value in a[2]) {
                    var i = a[2][value];
                    kaiguan3.push(i);
                }
                var d = eval(kaiguan3);
                for (var i = 0; i < p.length; i++) {
                    $("#autocomplete").append("<option value='" + p[i] + "'>" + p[i] + "</option>");
                }
                for (var i = 0; i < b.length; i++) {
                    $("#autocomplete").append("<option value='" + b[i] + "'>" + b[i] + "</option>");
                }

                for (var i = 0; i < c.length; i++) {
                    $("#autocomplete").append("<option value='" + c[i] + "'>" + c[i] + "</option>");
                }
                for (var i = 0; i < d.length; i++) {
                    $("#autocomplete").append("<option value='" + d[i] + "'>" + d[i] + "</option>");
                }
            }
        });
    });

    function download() {
        var url = address + "/query/excel";
        $("#form").attr("action", url);
        $("#form").submit();
    }

    function searchRole() {
        $("#dg").datagrid({
            dataType: 'json',
            type: 'post',
            queryParams: {
                nodeMark: $("#autocomplete").val(),
                startTime: $("#startTime").val(),
                endTime: $("#endTime").val(),
            },
            url: address + "/query/th/reportTime",
            columns: [
                [{
                        field: 'nodeMark',
                        title: '网关盒子ID',
                        width: 280
                    },
                    {
                        field: 'temper',
                        title: '温度',
                        width: 280
                    },
                    {
                        field: 'humidity',
                        title: '湿度',
                        width: 280
                    },
                    {
                        field: 'reportTime',
                        title: '上报时间',
                        width: 280
                    }
                ]
            ],
            pagination: true,
            pageSize: 10,
            pageList: [5, 10, 20]
        });
    }
</script>

</html>